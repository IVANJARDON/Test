CREATE OR REPLACE TABLE `mx-viva-bi-sandbox.test.unified_ads` AS
WITH
-- Facebook Ads data
facebook AS (
  SELECT
    date,
    'facebook' AS source,
    campaign_id,
    campaign_name,
    ad_set_id AS ad_group_id,   -- Standardizing ad set to ad group naming
    ad_set_name AS ad_group_name,
    impressions,
    clicks,
    spend AS cost,              -- Mapping spend to cost for cross-platform consistency
    conversions,
    video_views,
    engagement_rate,
    reach,
    frequency,
    -- Placeholder columns for schema alignment with other platforms
    NULL AS conversion_value,
    NULL AS ctr,
    NULL AS avg_cpc,
    NULL AS quality_score,
    NULL AS search_impression_share,
    NULL AS likes,
    NULL AS shares,
    NULL AS comments,
    NULL AS video_watch_25,
    NULL AS video_watch_50,
    NULL AS video_watch_75,
    NULL AS video_watch_100
  FROM `mx-viva-bi-sandbox.test.facebook_ads`
),

-- Google Ads data
google AS (
  SELECT
    date,
    'google' AS source,
    campaign_id,
    campaign_name,
    ad_group_id,
    ad_group_name,
    impressions,
    clicks,
    cost,
    conversions,
    -- Placeholder columns for Facebook/TikTok specific metrics
    NULL AS video_views,
    NULL AS engagement_rate,
    NULL AS reach,
    NULL AS frequency,
    -- Google specific metrics
    conversion_value,
    ctr,
    avg_cpc,
    quality_score,
    search_impression_share,
    -- Placeholder columns for TikTok specific metrics
    NULL AS likes,
    NULL AS shares,
    NULL AS comments,
    NULL AS video_watch_25,
    NULL AS video_watch_50,
    NULL AS video_watch_75,
    NULL AS video_watch_100
  FROM `mx-viva-bi-sandbox.test.google_ads`
),

-- TikTok Ads data
tiktok AS (
  SELECT
    date,
    'tiktok' AS source,
    campaign_id,
    campaign_name,
    adgroup_id AS ad_group_id,   -- Standardizing adgroup to ad group naming
    adgroup_name AS ad_group_name,
    impressions,
    clicks,
    cost,
    conversions,
    video_views,
    -- Placeholder columns for Facebook/Google specific metrics
    NULL AS engagement_rate,
    NULL AS reach,
    NULL AS frequency,
    NULL AS conversion_value,
    NULL AS ctr,
    NULL AS avg_cpc,
    NULL AS quality_score,
    NULL AS search_impression_share,
    -- TikTok specific social and video metrics
    likes,
    shares,
    comments,
    video_watch_25,
    video_watch_50,
    video_watch_75,
    video_watch_100
  FROM `mx-viva-bi-sandbox.test.tiktok_ads`
)

-- Combine all sources into a single dataset
SELECT * FROM facebook
UNION ALL
SELECT * FROM google
UNION ALL
SELECT * FROM tiktok;